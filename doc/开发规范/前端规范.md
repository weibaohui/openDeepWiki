# 前端开发规范

本规范适用于 openDeepWiki 项目前端开发，供 AI 和开发者在编写前端代码时遵守。

## 一、技术栈

| 技术 | 版本 | 用途 |
|------|------|------|
| React | 18.x | UI 框架 |
| TypeScript | 5.x | 类型安全 |
| Vite | 5.x | 构建工具 |
| Tailwind CSS | 4.x | 原子化样式 |
| shadcn/ui | latest | UI 组件库 |
| React Router | 6.x | 路由管理 |
| Axios | 1.x | HTTP 请求 |
| Lucide React | latest | 图标库 |

---

## 二、项目结构

```
frontend/
├── src/
│   ├── components/           # 通用组件
│   │   ├── ui/              # shadcn/ui 组件（自动生成）
│   │   ├── layout/          # 布局组件
│   │   └── common/          # 业务通用组件
│   ├── pages/               # 页面组件
│   ├── services/            # API 服务
│   ├── hooks/               # 自定义 Hooks
│   ├── types/               # TypeScript 类型定义
│   ├── lib/                 # 工具函数
│   ├── styles/              # 全局样式
│   ├── App.tsx              # 根组件
│   └── main.tsx             # 入口文件
├── components.json          # shadcn/ui 配置
├── tailwind.config.js       # Tailwind 配置
└── package.json
```

---

## 三、组件编写规范

### 3.1 组件文件命名

- 使用 **PascalCase** 命名组件文件：`UserProfile.tsx`
- 页面组件放在 `pages/` 目录
- 通用组件放在 `components/` 目录

### 3.2 组件结构模板

```tsx
// 1. 导入语句（按顺序）
import { useState, useEffect } from 'react';          // React 核心
import { useNavigate } from 'react-router-dom';       // 第三方库
import { Button } from '@/components/ui/button';      // UI 组件
import { cn } from '@/lib/utils';                     // 工具函数
import type { Repository } from '@/types';            // 类型定义
import { repositoryApi } from '@/services/api';       // API 服务

// 2. 类型定义
interface Props {
  id: string;
  className?: string;
  onSuccess?: () => void;
}

// 3. 组件实现
export function ComponentName({ id, className, onSuccess }: Props) {
  // 3.1 Hooks（按顺序：状态、路由、副作用）
  const [loading, setLoading] = useState(false);
  const [data, setData] = useState<Repository | null>(null);
  const navigate = useNavigate();

  // 3.2 副作用
  useEffect(() => {
    fetchData();
  }, [id]);

  // 3.3 事件处理函数
  const fetchData = async () => {
    setLoading(true);
    try {
      const res = await repositoryApi.get(Number(id));
      setData(res.data);
    } catch (error) {
      console.error('Failed to fetch:', error);
    } finally {
      setLoading(false);
    }
  };

  const handleClick = () => {
    onSuccess?.();
  };

  // 3.4 条件渲染
  if (loading) {
    return <div>Loading...</div>;
  }

  // 3.5 主渲染
  return (
    <div className={cn('flex flex-col gap-4', className)}>
      {/* 内容 */}
    </div>
  );
}

// 4. 默认导出（页面组件使用）
export default ComponentName;
```

### 3.3 组件导出规则

- **页面组件**：使用 `export default`
- **通用组件**：使用命名导出 `export function`
- **UI 组件**：遵循 shadcn/ui 的导出方式

---

## 四、shadcn/ui 使用规范

### 4.1 组件引用

```tsx
// ✅ 正确：从 @/components/ui 导入
import { Button } from '@/components/ui/button';
import { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card';
import { Input } from '@/components/ui/input';

// ❌ 错误：直接从 shadcn 导入
import { Button } from 'shadcn/ui';
```

### 4.2 常用组件

| 组件 | 用途 | 示例 |
|------|------|------|
| Button | 按钮 | `<Button variant="outline">Click</Button>` |
| Card | 卡片容器 | `<Card><CardContent>...</CardContent></Card>` |
| Input | 输入框 | `<Input placeholder="Enter..." />` |
| Dialog | 对话框 | `<Dialog><DialogTrigger>...</DialogTrigger></Dialog>` |
| Table | 表格 | `<Table><TableHeader>...</TableHeader></Table>` |
| Badge | 徽章标签 | `<Badge variant="secondary">Status</Badge>` |
| Skeleton | 骨架屏 | `<Skeleton className="h-4 w-full" />` |
| Toast | 提示消息 | `toast({ title: "Success" })` |

### 4.3 Button 变体使用场景

```tsx
// 主要操作
<Button>Submit</Button>

// 次要操作
<Button variant="secondary">Cancel</Button>

// 边框按钮
<Button variant="outline">Edit</Button>

// 危险操作
<Button variant="destructive">Delete</Button>

// 幽灵按钮（无背景）
<Button variant="ghost">More</Button>

// 链接样式
<Button variant="link">Learn more</Button>
```

---

## 五、Tailwind CSS 规范

### 5.1 类名顺序

遵循以下顺序组织 Tailwind 类名：

1. **布局**：`flex`, `grid`, `block`, `hidden`
2. **定位**：`relative`, `absolute`, `fixed`
3. **盒模型**：`w-`, `h-`, `p-`, `m-`
4. **排版**：`text-`, `font-`, `leading-`
5. **视觉**：`bg-`, `border-`, `rounded-`, `shadow-`
6. **交互**：`hover:`, `focus:`, `active:`
7. **动画**：`transition-`, `animate-`

```tsx
// ✅ 正确顺序
<div className="flex items-center justify-between w-full p-4 text-sm bg-white border rounded-lg shadow-sm hover:shadow-md transition-shadow">

// ❌ 混乱顺序
<div className="shadow-sm p-4 flex border bg-white hover:shadow-md w-full rounded-lg text-sm">
```

### 5.2 响应式设计

使用移动优先的响应式设计：

```tsx
// 移动优先
<div className="flex flex-col md:flex-row lg:gap-8">
  <div className="w-full md:w-1/2 lg:w-1/3">...</div>
</div>

// 断点说明
// sm: 640px   - 小平板
// md: 768px   - 平板
// lg: 1024px  - 小桌面
// xl: 1280px  - 大桌面
// 2xl: 1536px - 超大屏
```

### 5.3 深色模式

```tsx
// 使用 dark: 前缀支持深色模式
<div className="bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100">
  <p className="text-gray-600 dark:text-gray-400">Content</p>
</div>
```

### 5.4 使用 cn() 合并类名

```tsx
import { cn } from '@/lib/utils';

// 条件类名
<div className={cn(
  'flex items-center gap-2 p-4 rounded-lg',
  isActive && 'bg-blue-50 border-blue-200',
  isDisabled && 'opacity-50 cursor-not-allowed',
  className
)}>
```

---

## 六、状态管理规范

### 6.1 状态分类

| 类型 | 方案 | 示例 |
|------|------|------|
| 组件状态 | useState | 表单输入、开关状态 |
| 跨组件状态 | Context + useReducer | 用户信息、主题设置 |
| 服务端状态 | useState + useEffect | API 数据 |
| URL 状态 | useSearchParams | 筛选条件、分页 |

### 6.2 状态提升原则

- 状态应放在最近的共同父组件
- 避免过度使用全局状态
- 优先使用组件组合而非 Context

### 6.3 异步状态模式

```tsx
// 标准的异步数据获取模式
function useData<T>(fetcher: () => Promise<T>) {
  const [data, setData] = useState<T | null>(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<Error | null>(null);

  const fetch = async () => {
    setLoading(true);
    setError(null);
    try {
      const result = await fetcher();
      setData(result);
    } catch (e) {
      setError(e as Error);
    } finally {
      setLoading(false);
    }
  };

  return { data, loading, error, refetch: fetch };
}
```

---

## 七、API 调用规范

### 7.1 API 服务文件结构

```tsx
// services/api.ts
import axios from 'axios';
import type { Repository, Task, Document } from '@/types';

const API_BASE = import.meta.env.VITE_API_BASE || 'http://localhost:8080/api';

const api = axios.create({
  baseURL: API_BASE,
  headers: { 'Content-Type': 'application/json' },
});

// 按资源分组
export const repositoryApi = {
  list: () => api.get<Repository[]>('/repositories'),
  get: (id: number) => api.get<Repository>(`/repositories/${id}`),
  create: (url: string) => api.post<Repository>('/repositories', { url }),
  delete: (id: number) => api.delete(`/repositories/${id}`),
};

export const taskApi = {
  run: (id: number) => api.post(`/tasks/${id}/run`),
  reset: (id: number) => api.post(`/tasks/${id}/reset`),
};
```

### 7.2 错误处理

```tsx
// 统一错误处理
const handleApiError = (error: unknown) => {
  if (axios.isAxiosError(error)) {
    const message = error.response?.data?.error || error.message;
    toast({ title: 'Error', description: message, variant: 'destructive' });
  }
};

// 使用示例
try {
  await repositoryApi.create(url);
  toast({ title: 'Success', description: 'Repository created' });
} catch (error) {
  handleApiError(error);
}
```

---

## 八、类型定义规范

### 8.1 类型文件组织

```tsx
// types/index.ts
export interface Repository {
  id: number;
  name: string;
  url: string;
  status: RepositoryStatus;
  created_at: string;
  updated_at: string;
}

export type RepositoryStatus = 
  | 'pending' 
  | 'cloning' 
  | 'ready' 
  | 'analyzing' 
  | 'completed' 
  | 'error';

export interface Task {
  id: number;
  repository_id: number;
  type: TaskType;
  status: TaskStatus;
  title: string;
}

export type TaskType = 'overview' | 'architecture' | 'api' | 'business-flow' | 'deployment';
export type TaskStatus = 'pending' | 'running' | 'completed' | 'failed';
```

### 8.2 类型导入

```tsx
// ✅ 使用 type 关键字导入类型
import type { Repository, Task } from '@/types';

// ❌ 不推荐：混合导入
import { Repository, someFunction } from '@/types';
```

---

## 九、命名规范

### 9.1 文件命名

| 类型 | 规范 | 示例 |
|------|------|------|
| 组件文件 | PascalCase | `UserProfile.tsx` |
| Hook 文件 | camelCase | `useAuth.ts` |
| 工具函数 | camelCase | `formatDate.ts` |
| 类型文件 | camelCase | `index.ts` |
| 样式文件 | kebab-case | `global-styles.css` |

### 9.2 变量命名

```tsx
// 组件名：PascalCase
function UserProfile() {}

// 函数名：camelCase，动词开头
const fetchData = () => {};
const handleClick = () => {};
const formatDate = () => {};

// 布尔值：is/has/can 前缀
const isLoading = true;
const hasError = false;
const canEdit = true;

// 常量：UPPER_SNAKE_CASE
const API_BASE_URL = 'http://...';
const MAX_RETRY_COUNT = 3;

// 事件处理：handle 前缀
const handleSubmit = () => {};
const handleChange = () => {};

// 回调属性：on 前缀
interface Props {
  onSuccess?: () => void;
  onChange?: (value: string) => void;
}
```

---

## 十、最佳实践

### 10.1 性能优化

```tsx
// 1. 使用 useMemo 缓存计算结果
const filteredItems = useMemo(() => 
  items.filter(item => item.status === status),
  [items, status]
);

// 2. 使用 useCallback 缓存函数
const handleClick = useCallback(() => {
  setCount(c => c + 1);
}, []);

// 3. 列表渲染使用稳定的 key
{items.map(item => (
  <Item key={item.id} data={item} />  // ✅ 使用唯一 ID
))}

// 4. 避免在渲染中创建对象
// ❌ 每次渲染创建新对象
<Component style={{ color: 'red' }} />

// ✅ 提取为常量
const style = { color: 'red' };
<Component style={style} />
```

### 10.2 可访问性

```tsx
// 1. 图片必须有 alt
<img src={url} alt="Repository icon" />

// 2. 按钮必须有明确标签
<Button aria-label="Close dialog">
  <X className="h-4 w-4" />
</Button>

// 3. 表单输入关联 label
<label htmlFor="repo-url">Repository URL</label>
<Input id="repo-url" />

// 4. 使用语义化标签
<header>...</header>
<main>...</main>
<nav>...</nav>
<footer>...</footer>
```

### 10.3 代码组织

```tsx
// 1. 单一职责：每个组件只做一件事
// ❌ 一个组件做太多事
function Dashboard() {
  // 用户数据获取
  // 仓库数据获取
  // 任务数据获取
  // 统计计算
  // 渲染所有内容
}

// ✅ 拆分为多个组件
function Dashboard() {
  return (
    <div>
      <UserStats />
      <RepositoryList />
      <TaskProgress />
    </div>
  );
}

// 2. 组件文件不超过 300 行
// 超过时考虑拆分子组件

// 3. 提取复杂逻辑到自定义 Hook
function useRepositories() {
  const [repos, setRepos] = useState([]);
  const [loading, setLoading] = useState(true);
  // ... 逻辑
  return { repos, loading, refetch };
}
```

---

## 十一、禁止事项

### 11.1 严禁

- ❌ 使用 `any` 类型（除非有充分理由）
- ❌ 在组件内定义内联样式对象
- ❌ 直接操作 DOM（应使用 ref）
- ❌ 在渲染阶段产生副作用
- ❌ 使用 `index` 作为列表 key（有稳定 ID 时）

### 11.2 避免

- ⚠️ 过度使用 Context
- ⚠️ 组件嵌套超过 5 层
- ⚠️ 单个文件超过 300 行
- ⚠️ 在 useEffect 中不处理清理函数
- ⚠️ 忽略 TypeScript 错误

---

## 十二、代码审查清单

在提交代码前，确保：

- [ ] 所有组件都有 TypeScript 类型
- [ ] 使用了 shadcn/ui 组件而非自定义样式
- [ ] Tailwind 类名有序排列
- [ ] API 调用有错误处理
- [ ] 列表渲染有稳定的 key
- [ ] 图片有 alt 属性
- [ ] 没有未使用的导入
- [ ] 组件职责单一
- [ ] 复杂逻辑提取到 Hook
