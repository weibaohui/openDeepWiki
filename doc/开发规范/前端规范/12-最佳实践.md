# 最佳实践

本文档定义前端开发的最佳实践，包括性能优化、可访问性和代码组织。

本文示例不包含代码注释，原示例注释已移除，如需保留请自行补充。

## 性能优化

### 使用 useMemo 缓存计算结果

```tsx
const filteredItems = useMemo(() => 
  items.filter(item => item.status === status),
  [items, status]
);
```

### 使用 useCallback 缓存函数

```tsx
const handleClick = useCallback(() => {
  setCount(c => c + 1);
}, []);
```

### 列表渲染使用稳定的 key

```tsx
{items.map(item => (
  <Item key={item.id} data={item} />  // 使用唯一 ID
))}
```

### 避免在渲染中创建对象

```tsx
// 不推荐：每次渲染创建新对象
<Component style={{ color: 'red' }} />

// 推荐：提取为常量
const style = { color: 'red' };
<Component style={style} />
```

### 懒加载组件

```tsx
import { lazy, Suspense } from 'react';

const HeavyComponent = lazy(() => import('./HeavyComponent'));

function App() {
  return (
    <Suspense fallback={<Loading />}>
      <HeavyComponent />
    </Suspense>
  );
}
```

## 可访问性

### 图片必须有 alt

```tsx
<img src={url} alt="Repository icon" />
```

### 按钮必须有明确标签

```tsx
import { Button } from 'antd';
import { CloseOutlined } from '@ant-design/icons';

<Button aria-label="关闭">
  <CloseOutlined />
</Button>
```

### 表单输入关联 label

```tsx
import { Form, Input } from 'antd';

<Form layout="vertical">
  <Form.Item label="仓库地址" name="repoUrl" rules={[{ required: true }]}>
    <Input />
  </Form.Item>
</Form>
```

### 使用语义化标签

```tsx
<header>...</header>
<main>...</main>
<nav>...</nav>
<footer>...</footer>
```

### 键盘导航

```tsx
<button
  onKeyDown={(e) => {
    if (e.key === 'Enter' || e.key === ' ') {
      handleAction();
    }
  }}
>
  Action
</button>
```

## 代码组织

### 单一职责

```tsx
// 不推荐：一个组件做太多事
function Dashboard() {
  // 用户数据获取
  // 仓库数据获取
  // 任务数据获取
  // 统计计算
  // 渲染所有内容
}

// 推荐：拆分为多个组件
function Dashboard() {
  return (
    <div>
      <UserStats />
      <RepositoryList />
      <TaskProgress />
    </div>
  );
}
```

### 组件文件大小

- 组件文件不超过 300 行
- 超过时考虑拆分子组件

### 提取复杂逻辑到自定义 Hook

```tsx
function useRepositories() {
  const [repos, setRepos] = useState([]);
  const [loading, setLoading] = useState(true);
  // ... 逻辑
  return { repos, loading, refetch };
}
```

### 条件渲染模式

```tsx
// 简单条件
{isVisible && <Component />}

// 二选一
{isLoading ? <Skeleton /> : <Content />}

// 复杂条件提取函数
const renderContent = () => {
  if (loading) return <Skeleton />;
  if (error) return <Error />;
  if (!data) return <Empty />;
  return <Content data={data} />;
};

return <div>{renderContent()}</div>;
```

## 错误边界

```tsx
import { Component, type ReactNode } from 'react';

interface Props {
  children: ReactNode;
  fallback?: ReactNode;
}

interface State {
  hasError: boolean;
}

class ErrorBoundary extends Component<Props, State> {
  state = { hasError: false };

  static getDerivedStateFromError() {
    return { hasError: true };
  }

  componentDidCatch(error: Error) {
    console.error('Error caught:', error);
  }

  render() {
    if (this.state.hasError) {
      return this.props.fallback || <div>Something went wrong</div>;
    }
    return this.props.children;
  }
}
```

## 相关文档

- [禁止事项](./13-禁止事项.md)
- [代码审查清单](./14-代码审查清单.md)
