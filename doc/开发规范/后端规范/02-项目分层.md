# 项目分层

本文档定义项目的目录结构和各层职责。

## 目录结构

```text
cmd/server        // 启动入口，只做 wiring
internal/
  handler         // HTTP 层（Gin）
  service         // 业务编排层
  domain          // 领域模型（纯数据 + 规则）
  repository      // 数据访问层（GORM）
  model           // GORM Model
  middleware      // Gin 中间件
  pkg             // 通用工具
config/           // 配置管理
```

## 分层职责

### Handler（HTTP 层）

**职责**：处理 HTTP 请求和响应

- 参数绑定
- 参数校验
- 调用 Service
- 错误转换
- 返回统一 Response

**禁止**：
- 写业务逻辑
- 操作数据库
- 开启事务

### Service（业务层）

**职责**：业务逻辑编排

- 业务规则校验
- 多 Repository 协调
- 事务控制
- 领域对象转换

**禁止**：
- 依赖 Gin
- 直接使用 GORM
- 返回 GORM Model

### Repository（数据访问层）

**职责**：数据持久化

- CRUD 操作
- 数据查询
- Model 与 Domain 转换

**唯一**：
- 唯一允许使用 GORM 的地方

### Domain（领域层）

**职责**：业务概念定义

- 领域实体
- 值对象
- 业务规则

**禁止**：
- 依赖任何框架
- 依赖数据库
- JSON/DB tag

### Model（数据模型层）

**职责**：数据库映射

- 表结构定义
- GORM tag

**禁止**：
- 写业务方法
- 被 Service 直接使用

## 分层依赖规则

```
Handler → Service → Repository → Model
              ↓
           Domain
```

### 允许的依赖

| 层 | 可依赖 |
| -- | ------ |
| Handler | Service, Domain, DTO |
| Service | Repository, Domain, DTO |
| Repository | Model, Domain |
| Domain | 无 |
| Model | 无 |

### 禁止的依赖

| 层 | 禁止依赖 |
| -- | -------- |
| Handler | Repository, Model, GORM |
| Service | Gin, GORM, Model |
| Repository | Gin, Handler, Service |
| Domain | 所有框架 |

## 硬性规则

```
违反分层 = 错误实现
```

每一层只能做自己该做的事，跨层调用是严重错误。

## 相关文档

- [Handler 规范](./03-Handler规范.md)
- [Service 规范](./04-Service规范.md)
- [Repository 规范](./07-Repository规范.md)
