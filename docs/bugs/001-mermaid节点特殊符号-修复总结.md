# 0. 文件修改记录表

| 修改人 | 修改时间 | 修改内容 |
| ------ | -------- | -------- |
| AI     | 2026-02-11 | 新增修复总结 |

# 1. 修复内容概述
在 Mermaid 渲染前增加节点文本修复逻辑，自动为包含特殊符号且未加双引号的节点文本补齐双引号，确保图表可正常渲染。

# 2. 与缺陷说明对应关系
- 覆盖缺陷说明中的 `J[#[Tools] Macro]`、`K[#[Prompts] Macro]` 等场景
- 不影响普通节点文本的渲染行为

# 3. 关键实现点
- 修复逻辑位置：`frontend/src/components/markdown/MermaidRender.tsx`
- 在 Unicode 解码与括号清理之后执行节点文本引号补齐
- 仅对未被双引号包裹且包含特殊符号的节点文本做替换

# 4. 验证情况
- 执行 `pnpm run build`，构建成功
- 执行 `pnpm run lint`，存在历史遗留的类型检查问题，未由本次改动引入

# 5. 已知限制与待改进点
- 当前规则聚焦 `#` 与 `[]` 等特殊符号，若需扩展到更多符号，可在修复逻辑中扩展判定规则

# 6. 安全反思
- 修复逻辑仅对渲染前字符串进行本地处理，不涉及权限或敏感数据
- 未新增网络调用与日志输出，不会引入敏感信息泄露风险
