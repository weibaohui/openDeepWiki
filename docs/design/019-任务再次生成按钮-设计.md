# 019-任务再次生成按钮-设计.md

## 1. 概述

在仓库详情页左侧任务列表中新增“再次生成”按钮，允许任务成功后再次触发任务重试流程，复用现有任务重试接口。同时在文档展示页右上角增加“重新生成”按钮，触发当前文档对应任务的重试流程。

---

## 2. 页面与交互设计

### 2.1 位置

位于仓库详情页左侧任务列表项的操作区，与现有任务操作按钮保持一致风格。

### 2.2 状态规则

- 状态为 `succeeded`：按钮可用
- 状态为 `running` / `queued`：按钮不可用
- 其他状态按现有规则保持不变

### 2.3 交互流程

1. 用户点击“再次生成”
2. 前端调用任务重试接口 `POST /api/tasks/:id/retry`
3. 请求成功后刷新任务列表与仓库状态
4. 请求失败提示错误信息

### 2.4 文档展示页按钮

- 位置：文档展示页右上角编辑按钮之后
- 点击后调用任务重试接口 `POST /api/tasks/:id/retry`
- 请求成功后提示启动成功，不阻塞当前文档浏览
- 请求失败提示错误信息

---

## 3. 接口设计

复用既有接口：

```
POST /api/tasks/:id/retry
```

---

## 4. 代码改动范围

| 模块 | 说明 |
| --- | --- |
| 仓库详情页 | 任务列表操作区新增按钮 |
| 文档展示页 | 右上角新增“重新生成”按钮并触发任务重试 |
| API 服务封装 | 确认已有 retry 方法，若无则补充 |
| 任务状态刷新 | 点击后触发列表刷新 |

---

## 5. 风险与兼容性

- 仅新增按钮与调用，不影响现有任务状态机和后端逻辑
