# 任务统计显示功能总结

## 1. 功能概述
本功能在仓库详情页的任务列表上方增加了一个统计展示区域，实时显示当前仓库的任务排队数量（Queued）和正在执行的任务数量（Running）。这有助于用户快速了解系统的负载情况和任务处理进度。

## 2. 需求对应
| 需求点 | 实现情况 | 备注 |
| :--- | :--- | :--- |
| 显示排队中任务数量 | 已实现 | 对应状态 `queued` |
| 显示正在执行任务数量 | 已实现 | 对应状态 `running` |
| 数据自动刷新 | 已实现 | 跟随现有轮询机制自动更新 |

## 3. 关键实现点

### 3.1 后端实现
*   **Repository 层**：在 `TaskRepository` 中增加了 `GetTaskStats(repoID uint)` 方法，使用 SQL `GROUP BY status` 聚合查询任务数量。
*   **Service 层**：在 `TaskService` 中透传调用 Repository 的统计方法。
*   **Handler 层**：新增 `GET /api/repositories/:id/tasks/stats` 接口，返回任务统计数据的 JSON 对象。
*   **路由**：注册了新的 API 路由。

### 3.2 前端实现
*   **API Client**：在 `taskApi` 中增加了 `getStats` 方法。
*   **UI 组件**：在 `RepoDetail` 页面中，使用 `Promise.all` 并行请求任务列表和统计数据。
*   **展示**：使用 Ant Design 图标和排版组件展示统计数字。

## 4. 已知限制与待改进
*   当前统计接口是实时的，但前端采用轮询方式刷新，可能存在轻微的延迟。
*   未来可以考虑使用 WebSocket 推送状态变更。
*   目前仅展示了 Queued 和 Running 状态，未来可以扩展展示 Failed 或 Completed 状态的统计。

## 5. 变更文件清单
*   `backend/internal/repository/repository.go`
*   `backend/internal/repository/task_repo.go`
*   `backend/internal/service/task.go`
*   `backend/internal/handler/task.go`
*   `backend/internal/router/router.go`
*   `frontend/src/services/api.ts`
*   `frontend/src/pages/RepoDetail.tsx`
