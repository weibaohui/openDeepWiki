# 026-目录证据存储-设计.md

# 0. 文件修改记录表

| 修改人 | 修改时间 | 修改内容 |
| ------ | -------- | -------- |
| AI | 2026-02-07 | 初始版本 |

# 1. 总体方案
目录生成 Agent 输出 hint 列表，目录分析服务解析 hint，并在创建任务后将证据信息写入独立证据表，实现任务与证据的多对多样式关联（单任务多证据）。

# 2. 数据模型设计

## 2.1 Hint 表结构
- 表名：task_hints
- 字段：
  - id
  - repository_id
  - task_id
  - title
  - aspect
  - source
  - detail
  - created_at
  - updated_at
- 索引：
  - repository_id
  - task_id

## 2.2 目录输出结构映射
- dirs[].title → task.title、hint.title
- dirs[].hint[].aspect → hint.aspect
- dirs[].hint[].source → hint.source
- dirs[].hint[].detail → hint.detail

# 3. 服务端流程
1. 目录分析服务调用 Agent 获取目录与证据
2. 解析 JSON 为 dirSpec 结构
3. 创建任务记录
4. 依据 task_id 创建证据记录（多条）
5. 目录创建流程返回任务列表

# 4. 仓储层设计
- 新增 HintRepository
  - CreateBatch(hints []model.TaskHint) error
- 使用 AutoMigrate 创建 hint 表

# 5. 代码改动范围
- model：新增 TaskHint 数据模型
- repository：新增 HintRepository 实现
- dirmaker：解析 hint 字段并保存
- database：AutoMigrate 注册 Hint 表
- main：注入 HintRepository 到 dirmaker

# 6. 兼容性与安全
- hint 表独立，不改变 task 表结构
- hint 内容不包含本地路径或敏感信息
