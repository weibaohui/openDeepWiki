# 034-文档显示页面增加仓库名称显示-设计.md

# 0. 文件修改记录表

| 修改人 | 修改时间 | 修改内容 |
| ------ | -------- | -------- |
| AI | 2026-02-11 | 初始版本 |
| AI | 2026-02-11 | 调整位置：仓库名称显示在左侧边栏顶部，优化响应式设计 |
| AI | 2026-02-11 | 调整样式：增大仓库名称字体，在概览页显示仓库名称 |
| AI | 2026-02-11 | 增加文档更新时间、分支和commit id信息 |

## 1. 概述
在文档显示页左侧边栏顶部和文档概览页内容区域顶部增加仓库名称显示，并在仓库名称下方提供跳转和复制图标按钮，帮助用户识别文档来源仓库，并方便访问和分享仓库地址。同时确保响应式设计，在桌面端和移动端都能正常显示和使用。在概览页增加文档更新时间、分支和commit id信息，帮助用户了解仓库的更新情况。

---

## 2. 页面与交互设计

### 2.1 展示位置
- 位于文档显示页左侧边栏（Sider）顶部
- 移动端显示在侧边栏抽屉（Drawer）顶部
- 在"返回首页"按钮之前（侧边栏）
- 在文档概览页内容区域顶部，统计数据之前（概览页）

### 2.2 桌面端布局结构
```
┌─────────────────┬─────────────────────────────┐
│ 仓库名称         │  仓库名称                    │
│ ↗  📋          │  ↗  📋                      │
├─────────────────┤  🕐 更新时间 🏷️ 分支 🏷️ id   │
│ 返回首页         │  ┌─────────────────────────┐│
├─────────────────┤  │ 统计数据                ││
│ 文档列表        │  │ 文档总数: X             ││
│  - 文档1         │  │ 已完成: X               ││
│  - 文档2         │  │ 版本总数: X             ││
│  ...            │  │ 待生成: X               ││
└─────────────────┘  └─────────────────────────┘│
                    │  文档内容区域                │
```

### 2.3 概览页信息区域布局
```
┌────────────────────────────────────────────────────────────────────────────────────────────┐
│ 仓库名称                              ↗  📋                        🕐 更新时间 🏷️ main 🏷️ abc12345  │
├────────────────────────────────────────────────────────────────────────────────────────────┤
│ 统计数据                                                                                    │
│ ...                                                                                         │
└────────────────────────────────────────────────────────────────────────────────────────────┘
```

### 2.4 交互设计
1. **仓库名称**：纯文本显示，加粗
   - 侧边栏：fontSize: 16px
   - 概览页：fontSize: 24px
2. **跳转图标（↗）**：
   - 图标：`ExportOutlined`（从 @ant-design/icons 导入）
   - 点击行为：在新标签页打开仓库地址（repository.url）
   - 样式：text 类型按钮，灰色图标
   - 无效状态：仓库地址为空时不显示
3. **复制图标（📋）**：
   - 图标：`CopyOutlined`（从 @ant-design/icons 导入）
   - 点击行为：将仓库地址复制到剪贴板，显示 "复制成功" 提示
   - 样式：text 类型按钮，灰色图标
   - 无效状态：仓库地址为空时不显示
4. **文档更新时间**：
   - 图标：`ClockCircleOutlined`
   - 显示：使用最后一个更新的文档的 updated_at
   - 格式：通过 formatDateTime 函数格式化
   - 样式：13px，灰色文字
5. **分支信息**：
   - 组件：`Tag`
   - 颜色：蓝色（color="blue"）
   - 显示：repository.clone_branch
6. **Commit ID**：
   - 组件：`Tag`
   - 颜色：默认（灰色，color="default"）
   - 显示：repository.clone_commit_id 的前8位
   - 字体：等宽字体（fontFamily: 'monospace'）

### 2.5 响应式设计
- **桌面端（lg+，≥992px）**：
  - 显示在左侧边栏（Sider）顶部
  - 边栏宽度：250px
  - 仓库名称和图标按钮布局在顶部区域，带下边框分隔
  - 边栏支持滚动，高度为 100vh
- **移动端（<992px）**：
  - 显示在侧边栏抽屉（Drawer）顶部
  - 抽屉宽度：280px
  - Drawer 标题显示仓库名称
  - 抽屉内容区域包含仓库名称、图标按钮和文档列表
- **概览页信息区域**：
  - 使用 flexbox 布局，支持自动换行
  - 信息项之间有合适的间距（gap: 8px ~ 12px）
  - 元信息区域使用 marginLeft: 'auto' 推到右侧

---

## 3. 数据获取
- 使用仓库 ID 调用 `repositoryApi.get` 获取仓库详情
- 文档内容与文档列表依旧来自 `documentApi`
- 仓库请求失败时不影响文档展示
- `repository.url` 用于跳转和复制功能
- `repository.clone_branch` 用于显示分支信息
- `repository.clone_commit_id` 用于显示 commit id
- 从 documents 数组中计算最后一个更新的文档

---

## 4. 接口设计
- 复用现有接口：

```
GET /repositories/:id
```

- 响应字段：
  - `name`: 仓库名称（用于显示）
  - `url`: 仓库地址（用于跳转和复制）
  - `clone_branch`: 克隆分支（用于显示）
  - `clone_commit_id`: 克隆 commit id（用于显示）

---

## 5. 代码改动范围
| 模块 | 说明 |
| --- | --- |
| DocViewer 页面 | 计算最后一个更新的文档 |
| DocViewer 页面 SidebarContent | 在左侧边栏顶部增加仓库名称展示及图标按钮 |
| DocViewer 页面 Drawer | 移动端抽屉标题使用仓库名称 |
| DocViewer 页面 Content | 在概览页内容区域顶部增加仓库名称、图标按钮和元信息 |
| DocViewer 页面 Header | 移除原有的仓库名称显示 |
| i18n 文案 | 新增"复制成功"、"仓库地址为空"等中英文文案 |

---

## 6. 实现细节

### 6.1 计算最后一个更新的文档
```tsx
const lastUpdatedDocument = useMemo(() => {
    if (documents.length === 0) return null;
    return documents.reduce((latest, doc) => {
        return new Date(doc.updated_at) > new Date(latest.updated_at) ? doc : latest;
    });
}, [documents]);
```

### 6.2 概览页内容区域
在 DocViewer.tsx 的 `isIndexView` 条件中，在统计数据之前增加仓库名称和元信息：

```tsx
{isIndexView ? (
    <>
        <Card>
            {repository?.name && (
                <div style={{ marginBottom: 32 }}>
                    <div style={{ marginBottom: 16 }}>
                        <Title level={3} style={{ margin: 0, fontSize: '24px', marginBottom: 12 }}>
                            {repository.name}
                        </Title>
                        <div style={{ display: 'flex', alignItems: 'center', gap: 12, flexWrap: 'wrap' }}>
                            {repositoryUrl && (
                                <Space size={6} align="center">
                                    <Button
                                        type="text"
                                        icon={<ExportOutlined />}
                                        onClick={() => window.open(repositoryUrl, '_blank')}
                                        size="middle"
                                        style={{ color: 'var(--ant-color-text-secondary)' }}
                                        title={t('common.open_repository')}
                                    />
                                    <Button
                                        type="text"
                                        icon={<CopyOutlined />}
                                        onClick={() => {
                                            navigator.clipboard.writeText(repositoryUrl);
                                            messageApi.success(t('common.copy_success'));
                                        }}
                                        size="middle"
                                        style={{ color: 'var(--ant-color-text-secondary)' }}
                                        title={t('common.copy_repository_url')}
                                    />
                                </Space>
                            )}
                            <div style={{ display: 'flex', alignItems: 'center', gap: 8, fontSize: '14px', color: 'var(--ant-color-text-secondary)', marginLeft: 'auto' }}>
                                {lastUpdatedDocument && (
                                    <Space size={6} align="center">
                                        <ClockCircleOutlined style={{ fontSize: '14px' }} />
                                        <Text style={{ fontSize: '13px' }}>
                                            {t('document.updated_at')}: {formatDateTime(lastUpdatedDocument.updated_at)}
                                        </Text>
                                    </Space>
                                )}
                                {repository.clone_branch && (
                                    <Space size={6} align="center">
                                        <Tag color="blue" style={{ margin: 0 }}>
                                            {repository.clone_branch}
                                        </Tag>
                                    </Space>
                                )}
                                {repository.clone_commit_id && (
                                    <Space size={6} align="center">
                                        <Tag color="default" style={{ margin: 0, fontFamily: 'monospace' }}>
                                            {repository.clone_commit_id.substring(0, 8)}
                                        </Tag>
                                    </Space>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            )}
            <Row gutter={[16, 16]}>
                {/* 统计数据 */}
                ...
            </Row>
        </Card>
    </>
) : editing ? (
    ...
)}
```

---

## 7. 风险与兼容性
- 仓库信息获取失败时，文档内容仍可正常阅读与编辑
- 仓库地址为空时，图标按钮不显示
- 复制功能使用 `navigator.clipboard.writeText` API，需要浏览器支持
- 响应式断点使用 Ant Design 的 `useBreakpoint` hook，确保兼容性
- 移动端和桌面端图标按钮的点击区域需要足够大
- 概览页信息区域在小屏幕上需要自动换行适应

---

## 8. 安全与权限
- 沿用现有的鉴权机制（假设 API 路由受保护）
- 不在日志中输出仓库地址等敏感信息
- commit id 只显示前8位，不暴露完整信息
