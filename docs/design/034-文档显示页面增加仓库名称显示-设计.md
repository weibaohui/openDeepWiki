# 034-文档显示页面增加仓库名称显示-设计.md

# 0. 文件修改记录表

| 修改人 | 修改时间 | 修改内容 |
| ------ | -------- | -------- |
| AI | 2026-02-11 | 初始版本 |
| AI | 2026-02-11 | 调整位置：仓库名称显示在左侧边栏顶部，优化响应式设计 |

## 1. 概述
在文档显示页左侧边栏顶部增加仓库名称显示，并在仓库名称下方提供跳转和复制图标按钮，帮助用户识别文档来源仓库，并方便访问和分享仓库地址。同时确保响应式设计，在桌面端和移动端都能正常显示和使用。

---

## 2. 页面与交互设计

### 2.1 展示位置
- 位于文档显示页左侧边栏（Sider）顶部
- 移动端显示在侧边栏抽屉（Drawer）顶部
- 在"返回首页"按钮之前

### 2.2 桌面端布局结构
```
┌─────────────────┬─────────────────────────────┐
│ 仓库名称         │  文档标题                  │
│ ↗  📋          │  [编辑] [导出] [版本]       │
├─────────────────┤                             │
│ 返回首页         │                             │
├─────────────────┤                             │
│ 文档列表        │  文档内容区域                │
│  - 文档1         │                             │
│  - 文档2         │                             │
│  ...            │                             │
└─────────────────┴─────────────────────────────┘
```

### 2.3 移动端布局结构
打开侧边栏抽屉时：
```
┌─────────────────────────────┐
│ 仓库名称         [×]        │
│ ↗  📋                     │
├─────────────────────────────┤
│ 返回首页                     │
├─────────────────────────────┤
│ 文档列表                     │
│  - 文档1                     │
│  - 文档2                     │
│  ...                        │
└─────────────────────────────┘
```

### 2.4 交互设计
1. **仓库名称**：纯文本显示，加粗，不可点击
2. **跳转图标（↗）**：
   - 图标：`ExportOutlined`（从 @ant-design/icons 导入）
   - 点击行为：在新标签页打开仓库地址（repository.url）
   - 样式：text 类型按钮，灰色图标
   - 无效状态：仓库地址为空时不显示
3. **复制图标（📋）**：
   - 图标：`CopyOutlined`（从 @ant-design/icons 导入）
   - 点击行为：将仓库地址复制到剪贴板，显示 "复制成功" 提示
   - 样式：text 类型按钮，灰色图标
   - 无效状态：仓库地址为空时不显示

### 2.5 响应式设计
- **桌面端（lg+，≥992px）**：
  - 显示在左侧边栏（Sider）顶部
  - 边栏宽度：250px
  - 仓库名称和图标按钮布局在顶部区域，带下边框分隔
  - 边栏支持滚动，高度为 100vh
- **移动端（<992px）**：
  - 显示在侧边栏抽屉（Drawer）顶部
  - 抽屉宽度：280px
  - Drawer 标题显示仓库名称
  - 抽屉内容区域包含仓库名称、图标按钮和文档列表

---

## 3. 数据获取
- 使用仓库 ID 调用 `repositoryApi.get` 获取仓库详情
- 文档内容与文档列表依旧来自 `documentApi`
- 仓库请求失败时不影响文档展示
- `repository.url` 用于跳转和复制功能

---

## 4. 接口设计
- 复用现有接口：

```
GET /repositories/:id
```

- 响应字段：
  - `name`: 仓库名称（用于显示）
  - `url`: 仓库地址（用于跳转和复制）

---

## 5. 代码改动范围
| 模块 | 说明 |
| --- | --- |
| DocViewer 页面 SidebarContent | 在左侧边栏顶部增加仓库名称展示及图标按钮 |
| DocViewer 页面 Drawer | 移动端抽屉标题使用仓库名称 |
| DocViewer 页面 Header | 移除原有的仓库名称显示 |
| i18n 文案 | 新增"复制成功"、"仓库地址为空"等中英文文案 |

---

## 6. 实现细节

### 6.1 组件结构
在 DocViewer.tsx 的 `SidebarContent` 函数中，在"返回首页"按钮之前增加仓库名称和图标按钮：

```tsx
const SidebarContent = () => (
    <>
        {/* 仓库名称和操作按钮 */}
        <div style={{
            padding: '12px 16px',
            borderBottom: '1px solid var(--ant-color-border-secondary)',
            backgroundColor: 'var(--ant-color-bg-container)'
        }}>
            {repository?.name && (
                <div>
                    <Text strong style={{ fontSize: '14px', display: 'block', marginBottom: 6 }}>
                        {repository.name}
                    </Text>
                    {repositoryUrl && (
                        <Space size={8} align="center" wrap>
                            <Button
                                type="text"
                                icon={<ExportOutlined />}
                                onClick={() => window.open(repositoryUrl, '_blank')}
                                size="small"
                                style={{ padding: '0 4px', color: 'var(--ant-color-text-secondary)' }}
                                title={t('common.open_repository')}
                            />
                            <Button
                                type="text"
                                icon={<CopyOutlined />}
                                onClick={() => {
                                    navigator.clipboard.writeText(repositoryUrl);
                                    messageApi.success(t('common.copy_success'));
                                }}
                                size="small"
                                style={{ padding: '0 4px', color: 'var(--ant-color-text-secondary)' }}
                                title={t('common.copy_repository_url')}
                            />
                        </Space>
                    )}
                </div>
            )}
        </div>

        {/* 返回首页按钮 */}
        <div style={{ padding: '8px 16px', borderBottom: '1px solid var(--ant-color-border-secondary)' }}>
            <Button
                type="text"
                icon={<ArrowLeftOutlined />}
                onClick={() => navigate(`/`)}
                block
                style={{ textAlign: 'left' }}
            >
                {t('nav.home')}
            </Button>
        </div>

        {/* 文档列表 */}
        ...
    </>
);
```

### 6.2 桌面端和移动端布局
```tsx
{screens.lg ? (
    <Sider width={250} theme="light" style={{
        borderRight: '1px solid var(--ant-color-border-secondary)',
        overflow: 'auto',
        height: '100vh'
    }}>
        <SidebarContent />
    </Sider>
) : (
    <Drawer
        title={repository?.name || t('repository.docs')}
        placement="left"
        onClose={() => setMobileMenuOpen(false)}
        open={mobileMenuOpen}
        width={280}
        styles={{ body: { padding: 0 } }}
    >
        <SidebarContent />
    </Drawer>
)}
```

### 6.3 图标选择
- 跳转图标：`ExportOutlined`
- 复制图标：`CopyOutlined`

### 6.4 国际化文案
需要新增以下文案（在 i18n 文件中）：

#### zh-CN.json
```json
{
    "common": {
        "open_repository": "打开仓库",
        "copy_repository_url": "复制仓库地址",
        "copy_success": "复制成功",
        "repository_url_empty": "仓库地址为空"
    }
}
```

#### en-US.json
```json
{
    "common": {
        "open_repository": "Open Repository",
        "copy_repository_url": "Copy Repository URL",
        "copy_success": "Copied successfully",
        "repository_url_empty": "Repository URL is empty"
    }
}
```

---

## 7. 风险与兼容性
- 仓库信息获取失败时，文档内容仍可正常阅读与编辑
- 仓库地址为空时，图标按钮不显示
- 复制功能使用 `navigator.clipboard.writeText` API，需要浏览器支持
- 响应式断点使用 Ant Design 的 `useBreakpoint` hook，确保兼容性
- 移动端和桌面端图标按钮的点击区域需要足够大（使用 small 尺寸按钮）

---

## 8. 安全与权限
- 沿用现有的鉴权机制（假设 API 路由受保护）
- 不在日志中输出仓库地址等敏感信息
