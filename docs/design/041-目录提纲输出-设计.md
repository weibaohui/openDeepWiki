# 041-目录提纲输出-设计.md

# 0. 文件修改记录表

| 修改人 | 修改时间 | 修改内容 |
| ------ | -------- | -------- |
| AI | 2026-02-13 | 初始版本 |

## 一、需求概述

目录生成阶段需要输出写作提纲 outline，并将其写入 Task 表，保证后续任务与同步流程可访问该提纲。

## 二、技术设计

### 2.1 数据模型

- Task 新增 outline 字段，类型 text，允许为空

### 2.2 目录生成结构

- DirMakerDirSpec 增加 outline 字段
- toc_editor 输出格式新增 outline
- toc_checker 输出模板同步新增 outline

### 2.3 任务创建流程

- tocWriter 在创建文档任务时把 outline 写入 Task
- 其他任务创建不强制传入 outline

### 2.4 同步导入导出

- PullTaskData 与 TaskCreateRequest 增加 outline 字段
- 同步导出与导入任务时覆盖 outline

## 三、影响范围

- backend/internal/domain/dirmaker.go
- backend/agents/toc_editor.yaml
- backend/agents/toc_checker.yaml
- backend/internal/domain/writers/toc.go
- backend/internal/model/models.go
- backend/internal/pkg/database/database.go
- backend/internal/dto/sync/sync.go
- backend/internal/service/sync/service.go
- backend/internal/service/sync/service_test.go
