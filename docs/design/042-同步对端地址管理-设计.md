# 042-同步对端地址管理-设计.md

# 0. 文件修改记录表

| 修改人 | 修改时间 | 修改内容 |
| ------ | -------- | -------- |
| AI | 2026-02-15 | 初始版本 |
| AI | 2026-02-15 | 存储方案改为数据库持久化 |

## 一、需求概述

在 `/sync` 页面提供对端地址的服务端记录与快速点选能力，减少重复输入并降低地址错误率。

## 二、技术设计

### 2.1 存储方案

- 使用数据库持久化
- 表：`sync_targets`
- 字段：
  - `id`：自增主键
  - `url`：对端地址（唯一）
  - `created_at`：创建时间
  - `updated_at`：更新时间

### 2.2 地址校验

- 前缀必须是 `http://` 或 `https://`
- 必须包含 `/api/sync`
- 使用简单正则或字符串规则即可，不做 DNS/连通性校验

### 2.3 UI 结构

- 在目标服务器输入框附近新增：
  - “保存地址”按钮
  - “常用对端地址”列表（可选中填充）
  - 列表项右侧删除按钮

### 2.4 数据流

1. 页面初始化时通过接口读取地址列表并渲染
2. 用户输入地址 → 校验通过 → 调用接口保存并刷新列表
3. 用户点击列表项 → 将地址写入目标服务器输入框
4. 用户删除地址 → 调用接口删除并刷新列表

### 2.5 约束与边界

- 最大保存 20 条，超过上限删除最旧记录
- 去重逻辑：保存前移除已有相同地址，再插入为最新

## 三、实现步骤

1. 新增同步地址存储模型与仓储
2. 新增同步地址管理接口
3. 在 `Sync.tsx` 调用接口保存、选择、删除并刷新
4. 增加 i18n 文案

## 四、测试要点

- 保存合法地址并刷新页面仍保留
- 点击列表项能够填充输入框
- 删除地址立即生效
- 非法地址保存提示正确
