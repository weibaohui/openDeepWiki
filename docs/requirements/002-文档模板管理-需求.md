# 002-文档模板管理-需求.md

> **状态：已废除**  
> **废除原因**：已采用基于 AI 的分析生成流程，不再需要模板化文档与模板管理功能。  
> **废除范围**：需求中涉及的后端 API、前端界面、数据模型与初始化、业务逻辑均停止推进。  
> **替代方案**：统一使用 AI 分析生成目录与任务。

# 0. 文件修改记录表

| 修改人 | 修改时间 | 修改内容 |
| ------ | -------- | -------- |
| AI | 2026-02-06 | 追加废除说明与补充变更记录表 |

## 1. 背景（Why）

当前系统的任务类型和文档模板被硬编码在代码中，无法灵活调整。用户无法自定义文档目录结构和文档类型，限制了系统的扩展性和可配置性。
为了支持不同技术栈（如 SpringBoot、前端项目）和不同场景的文档生成需求，需要将模板数据化，支持用户自定义模板套件（Template）、章节（Chapter）和文档（Document）。

## 2. 目标（What，必须可验证）

- [ ] **数据化模板管理**：将硬编码的模板迁移至数据库存储。（已废除）
- [ ] **三层结构支持**：（已废除）
    - **模板（Template）**：一套完整的文档生成方案（如“通用模板”、“SpringBoot模板”）。
    - **章节（Chapter）**：模板下的一级目录（如“架构分析”）。
    - **文档（Document）**：章节下的二级具体文档（如“数据架构”、“业务架构”）。
- [ ] **管理界面**：提供可视化的模板/章节/文档增删改查界面。（已废除）
- [ ] **预置模板库**：内置通用模板、SpringBoot模板、前端模板等典型配置。（已废除）
- [ ] **自定义能力**：支持用户创建新的模板套件，并自定义其下的章节和文档结构。（已废除）

## 3. 非目标（Explicitly Out of Scope）

- [ ] 修改现有已生成的文档内容
- [ ] 文档内容的自动调整（仅调整模板结构）
- [ ] 文档模板的版本管理（V1, V2...）
- [ ] 文档模板的导入导出功能

## 4. 使用场景 / 用户路径

### 场景 1：查看预置模板

```
用户登录系统 → 点击设置 → 点击"文档模板管理"
                ↓
            查看列表：通用模板、SpringBoot模板、前端模板
                ↓
            点击"通用模板"查看详情
                ↓
            看到章节列表（如：项目概览、架构分析...）
                ↓
            展开"架构分析"章节，看到文档列表（数据架构、业务架构）
```

### 场景 2：新增自定义模板

```
用户进入文档模板管理 → 点击"新增模板"
                ↓
            输入模板名称（如"微服务模板"）、标识（microservice）
                ↓
            添加章节（如"服务治理"）
                ↓
            在章节下添加文档（如"限流策略"、"熔断机制"）
                ↓
            保存配置
```

### 场景 3：基于模板生成文档

```
系统创建新仓库 → 选择使用的模板（如"SpringBoot模板"）
                ↓
            系统读取该模板下的所有章节和文档配置
                ↓
            生成对应的任务列表
                ↓
            任务执行时，按章节/文档结构生成文件
```

## 5. 功能需求清单（Checklist）
> 本清单整体已废除，不再作为前后端实现任务。

### 5.1 数据模型

- [ ] 创建文档模板表（document_templates）（已废除）
- [ ] 创建模板章节表（template_chapters）- 对应一级目录（已废除）
- [ ] 创建模板文档表（template_documents）- 对应二级目录（已废除）
- [ ] 建立清晰的 Template -> Chapter -> Document 关联关系（已废除）

### 5.2 数据初始化

- [ ] **初始化通用模板**：（已废除）
  - 项目概览
  - 架构分析（含：数据架构、业务架构）
  - 核心接口
  - 业务流程
  - 部署配置
- [ ] **初始化 SpringBoot 模板**：（已废除）
  - 包含 Controller、Service、Repository 层分析等
- [ ] **初始化前端模板**：（已废除）
  - 包含 组件分析、路由配置、状态管理等

### 5.3 后端 API

- [ ] 获取文档模板列表（已废除）
- [ ] 获取文档模板详情（包含章节和文档的树形结构）（已废除）
- [ ] 创建/更新/删除文档模板（已废除）
- [ ] 章节管理（增删改）（已废除）
- [ ] 文档管理（增删改）（已废除）

### 5.4 前端界面

- [ ] 模板列表页（已废除）
- [ ] 模板详情/编辑页（树形结构展示章节和文档）（已废除）
- [ ] 支持章节和文档的拖拽排序（已废除）

### 5.5 业务逻辑

- [ ] 仓库创建时支持选择模板（已废除）
- [ ] 任务生成逻辑适配新的三层结构（已废除）

## 6. 约束条件

### 6.1 技术约束

- 必须使用现有的数据库（SQLite / MySQL）
- 必须兼容现有的任务系统

### 6.2 架构约束

- **严格的两级目录结构**：模板下必须是章节，章节下必须是文档，不支持无限层级嵌套。
- 模板与任务类型解耦。

### 6.3 安全约束

- 系统预置模板（is_system=true）不可删除，但可克隆。

## 7. 可修改 / 不可修改项

- ❌ 不可修改：
  - 现有数据库表结构（新增表除外）
- ✅ 可调整：
  - 模板的具体字段
  - 前端交互方式

## 8. 接口与数据约定

### 8.1 数据模型

#### document_templates 表 (模板套件)

| 字段名 | 类型 | 说明 | 备注 |
|--------|------|------|------|
| id | uint | 主键 | |
| key | string | 模板标识 | 如 general, springboot, frontend |
| name | string | 模板名称 | 如"通用模板" |
| description | string | 描述 | |
| is_system | bool | 是否系统预置 | true表示不可删除 |
| sort_order | int | 排序序号 | |
| created_at | datetime | 创建时间 | |
| updated_at | datetime | 更新时间 | |

#### template_chapters 表 (一级章节)

| 字段名 | 类型 | 说明 | 备注 |
|--------|------|------|------|
| id | uint | 主键 | |
| template_id | uint | 关联模板ID | 外键 |
| title | string | 章节标题 | 如"架构分析" |
| sort_order | int | 排序序号 | |
| created_at | datetime | 创建时间 | |
| updated_at | datetime | 更新时间 | |

#### template_documents 表 (二级文档)

| 字段名 | 类型 | 说明 | 备注 |
|--------|------|------|------|
| id | uint | 主键 | |
| chapter_id | uint | 关联章节ID | 外键 |
| title | string | 文档标题 | 如"数据架构" |
| filename | string | 建议文件名 | 如 data_architecture.md |
| content_prompt | text | 内容生成提示 | 指导 LLM 生成内容 |
| sort_order | int | 排序序号 | |
| created_at | datetime | 创建时间 | |
| updated_at | datetime | 更新时间 | |

### 8.2 API 定义

#### 获取文档模板详情

```
GET /api/document-templates/:id
```

响应：
```json
{
  "data": {
    "id": 1,
    "key": "general",
    "name": "通用模板",
    "chapters": [
      {
        "id": 101,
        "title": "架构分析",
        "sort_order": 2,
        "documents": [
          {
            "id": 1001,
            "title": "数据架构",
            "filename": "data_arch.md",
            "content_prompt": "分析项目的数据模型...",
            "sort_order": 1
          },
          {
            "id": 1002,
            "title": "业务架构",
            "filename": "biz_arch.md",
            "content_prompt": "分析项目的业务流程...",
            "sort_order": 2
          }
        ]
      },
      {
        "id": 102,
        "title": "核心接口",
        "sort_order": 3,
        "documents": []
      }
    ]
  }
}
```

## 9. 验收标准（Acceptance Criteria）

- 以上验收标准随功能废除而停止执行，仅保留历史记录。

## 10. 风险与已知不确定点

- **风险**：旧数据的迁移策略。
  - **对策**：旧数据可归类为“默认/旧版模板”，保持向后兼容。
