# 008-AI分析按钮-需求

## 需求概述

在仓库(repo)卡片上增加一个AI分析按钮，点击后触发后端Agent结合Skill和Tools完成文档解析工作，最终生成的文档保存在目标仓库目录下，便于后台查看。

## 目标

1. 提供一键式AI分析入口，简化用户操作流程
2. 使用Agent系统完成从代码解析到文档生成的完整流程
3. 生成的文档直接保存在目标仓库目录中，便于查看和管理
4. 保证MVP级别的完整流程可用

## 功能需求

### 1. 前端界面

- [ ] 在首页仓库卡片上增加"AI分析"按钮
- [ ] 按钮状态管理：根据仓库状态显示可用/禁用状态
- [ ] 分析状态反馈：显示分析中、分析完成、分析失败等状态
- [ ] 支持国际化（中英文）

### 2. 后端API

- [ ] 新增 `POST /api/repositories/{id}/ai-analyze` 接口
- [ ] 接口验证仓库状态（仅 ready/completed 状态可触发）
- [ ] 返回任务ID或分析会话ID用于状态跟踪

### 3. Agent系统调用

- [ ] 触发 `explorer-agent` 进行代码探索
- [ ] 触发 `writer-agent` 生成文档内容
- [ ] 使用相关Skills（code-explanation、doc-generation等）
- [ ] 使用Tools（filesystem、code解析等）

### 4. 文档生成与存储

- [ ] 生成的文档保存格式：Markdown
- [ ] 存储位置：`{repo_local_path}/.opendeepwiki/analysis-report.md`
- [ ] 文档内容包含：项目概述、核心模块分析、关键函数说明

### 5. 状态管理

- [ ] 记录分析任务状态（pending/running/completed/failed）
- [ ] 支持查询分析进度
- [ ] 失败时记录错误信息

## 非功能需求

1. **性能**：分析过程异步执行，不阻塞API响应
2. **并发**：同一时间同一仓库只能有一个分析任务在执行
3. **安全**：仅允许对已成功克隆的仓库进行分析
4. **可扩展**：架构设计支持后续增加更多Agent类型

## MVP范围

### 包含

- 基础的AI分析按钮和触发流程
- ExplorerAgent + WriterAgent的协作
- 生成单份综合分析文档
- 文档保存到仓库目录

### 不包含（后续迭代）

- 多Agent复杂编排（使用完整Orchestrator）
- 文档模板选择
- 分析结果的数据库存储
- 历史分析记录查看

## 验收标准

1. [ ] 用户可以在仓库卡片上看到"AI分析"按钮
2. [ ] 点击按钮后，后端正确触发Agent进行分析
3. [ ] 分析完成后，可以在仓库目录下找到生成的文档
4. [ ] 分析过程中按钮显示适当的状态反馈
5. [ ] 分析失败时能看到错误提示

## 相关文档

- [设计文档](../design/008-AI分析按钮-设计.md)
- [Agent系统设计](../design/007-典型仓库解读Agent系统-设计.md)
- [Agent-Skill-MCP分工](../design/006-Agent-Skill-Mcp-分工.md)
