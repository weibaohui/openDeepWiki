# 任务统计显示需求文档

## 1. 背景
当前在仓库详情页的任务列表页面，用户只能看到具体的任务列表，无法直观地了解当前仓库中有多少任务正在排队，有多少任务正在执行。当任务较多时，用户难以快速评估系统的繁忙程度和任务处理进度。

同时，任务列表中的操作按钮（如执行、取消、重试、删除）在不可用状态下直接隐藏，导致界面布局跳动，且用户无法直观感知该任务具有哪些潜在操作功能。

## 2. 目标
1.  **新增统计展示**：在仓库详情页（RepoDetail）的任务列表上方，增加一个统计展示区域，实时显示当前仓库的排队中任务数量 (Queued) 和正在执行任务数量 (Running)。
2.  **优化按钮交互**：任务列表中的操作按钮由“不可用时隐藏”改为“不可用时禁用（置灰）”，保持界面布局稳定，提升功能可见性。

## 3. 详细需求

### 3.1 统计展示需求
*   位置：在“任务列表”标题或列表上方。
*   样式：使用卡片或统计小方块（类似 Ant Design 的 Statistic 组件）。
*   内容：
    *   显示“排队中”数量。
    *   显示“执行中”数量。
*   交互：数据应随任务列表自动刷新。

### 3.2 任务操作按钮需求
*   **原则**：所有操作按钮常驻显示，根据任务状态判断是否可用（Disabled）。
*   **按钮定义**：
    1.  **执行 (Run)**:
        *   图标：`PlayCircleOutlined`
        *   可用条件：任务状态为 `pending`。
        *   禁用状态：非 `pending` 状态时显示但不可点击。
    2.  **取消 (Cancel)**:
        *   图标：`StopOutlined`
        *   可用条件：任务状态为 `running` 或 `queued`。
        *   禁用状态：非运行/排队状态时显示但不可点击。
    3.  **重试/重新生成 (Retry/Regenerate)**:
        *   图标：`ReloadOutlined`
        *   可用条件：任务状态为 `completed`, `succeeded`, `failed`, `canceled`。
        *   禁用状态：`pending`, `running`, `queued` 状态时显示但不可点击。
    4.  **删除 (Delete)**:
        *   图标：`DeleteOutlined`
        *   可用条件：任务状态 **非** `running` 且 **非** `queued`。
        *   禁用状态：正在运行或排队时显示但不可点击。
    5.  **查看文档 (View Docs)**:
        *   图标：`FileTextOutlined`
        *   可用条件：该任务关联了文档。
        *   禁用状态：未关联文档时显示但不可点击。

### 3.3 批量重试无文档任务
*   **入口位置**：右侧“更多操作”菜单抽屉内的“任务管理”区域。
*   **按钮名称**：重试无文档任务。
*   **触发逻辑**：批量触发“无文档且可重试”的任务重试操作。
    *   无文档判断：文档链接不可点击（任务未关联文档）。
    *   可重试条件：与单任务“重试/再次生成”按钮一致（非 `pending`、`running`、`queued`）。
*   **交互反馈**：
    *   当无可重试任务时，按钮禁用并提示“暂无可重试任务”。
    *   批量重试成功后，提示本次触发的任务数量并刷新列表。

### 3.4 更多操作菜单调整
*   **入口位置**：仓库详情页右上角“更多操作”菜单抽屉。
*   **新增按钮**：
    1. **重新下载仓库**：触发仓库重新克隆流程。
    2. **仅删除仓库目录**：仅删除仓库在磁盘上的本地目录，不删除仓库记录、任务与文档。
    3. **删除仓库**：删除仓库及其相关任务与文档，需二次确认。

## 4. 验收标准
1.  进入仓库详情页，任务列表上方显示统计卡片，数字准确。
2.  任务列表中的每个任务项，右侧操作区域始终显示 5 个按钮（Run, Cancel, Retry, Delete, Docs）。
3.  根据任务状态，按钮呈现正确的可用/禁用状态。
    *   例如：Pending 状态的任务，Run 和 Delete 可用，其他禁用。
    *   Running 状态的任务，Cancel 可用，其他禁用。
    *   Failed 状态的任务，Retry 和 Delete 可用，Run 和 Cancel 禁用。
4.  当存在无文档且可重试任务时，点击“重试无文档任务”可触发批量重试，并刷新列表。
5.  当不存在无文档且可重试任务时，“重试无文档任务”按钮不可点击，并展示提示文案。
6.  右侧“更多操作”抽屉内新增“重新下载仓库”和“删除仓库”按钮，且功能可用。
7.  右侧“更多操作”抽屉内新增“仅删除仓库目录”按钮，且仅删除本地目录不影响数据记录。
