# 029-文档评分-需求.md

# 0. 文件修改记录表

| 修改人 | 修改时间 | 修改内容 |
| ------ | -------- | -------- |
| AI | 2026-02-09 | 初始版本 |

# 1. 背景（Why）
文档生成后缺少用户反馈入口，无法量化文档质量与满意度，也无法为后续改进提供依据。需要在文档阅读页增加评分能力，支持基础统计展示并持久化保存。

# 2. 目标（What，必须可验证）
- [ ] 文档阅读页支持 1-5 星评分
- [ ] 用户可提交评分并看到即时反馈
- [ ] 显示当前文档的平均分与评分次数
- [ ] 评分数据持久化保存并可查询
- [ ] 移动端与桌面端均可正常操作

# 3. 非目标（Explicitly Out of Scope）
- 不引入用户账号体系或登录鉴权
- 不提供评分评论或文本反馈
- 不提供评分历史导出

# 4. 使用场景 / 用户路径
1. 用户进入文档阅读页
2. 页面展示当前平均分与评分次数
3. 用户选择星级并提交
4. 系统保存评分并刷新统计信息

# 5. 功能需求清单（Checklist）
- [ ] 前端展示评分组件与统计信息
- [ ] 前端支持提交评分并处理失败提示
- [ ] 后端新增评分接口与统计接口
- [ ] 后端保存评分并计算平均分、评分次数
- [ ] 评分接口具备幂等或重复提交处理规则
- [ ] 日志使用 klog.V(6) 输出核心流程

# 6. 约束条件（非常关键）
- 技术约束：Go + Gin + Gorm + React + Ant Design
- 架构约束：遵循现有分层结构（Handler/Service/Repository/Model）
- 安全约束：不记录客户端敏感标识或原始 IP
- 性能约束：统计查询不影响文档加载体验

# 7. 可修改 / 不可修改项
- ❌ 不可修改：现有文档内容与版本策略
- ✅ 可调整：文档阅读页 UI 布局与统计展示样式

# 8. 接口与数据约定（如适用）
- 数据库表：
  - document_ratings
    - id
    - document_id
    - score
    - created_at
    - updated_at
- 接口：
  - POST /api/documents/:id/ratings
    - 请求：{ "score": 1-5 }
    - 响应：{ "average_score": number, "rating_count": number }
  - GET /api/documents/:id/ratings/stats
    - 响应：{ "average_score": number, "rating_count": number }


# 9. 验收标准（Acceptance Criteria）
- 文档阅读页可见评分组件、平均分与评分次数
- 提交评分后平均分与次数更新且页面无报错
- 评分接口与统计接口返回数据准确
- 中英文文案可切换展示

# 10. 风险与已知不确定点
- 匿名评分可能存在刷分风险，暂不处理
- 评分统计在高并发下需考虑缓存或聚合策略

# 11. 非目标
- 不实现评分排行榜
- 不实现评分审核机制
